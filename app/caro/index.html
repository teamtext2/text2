<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text2 - Caro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }
        }

        .game-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .game-board-wrapper {
            flex: 2;
            overflow: auto;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1rem;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(var(--cols), 1fr);
            gap: 4px;
            background-color: #cbd5e1;
            padding: 4px;
            border-radius: 0.5rem;
        }

        .cell {
            width: 40px;
            height: 40px;
            background-color: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: #334155;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            border-radius: 0.5rem;
            user-select: none;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .cell:hover {
            transform: scale(1.05);
            background-color: #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }

        .cell.x {
            color: #ef4444; /* red-500 */
        }

        .cell.o {
            color: #3b82f6; /* blue-500 */
        }
        
        .cell.win {
            background-color: #dcfce7; /* green-200 */
            color: #15803d; /* green-700 */
            transform: scale(1.1);
            animation: win-pulse 1s infinite;
        }

        .button {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        @keyframes win-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 252, 231, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(220, 252, 231, 0); }
        }

        .modal {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            transition: opacity 0.3s ease;
        }

        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }

    </style>
</head>
<body class="p-4 md:p-8">
    <div class="container">
        <!-- Game Information & Controls -->
        <div class="game-info">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-2">Text2 - Caro</h1>
            <p class="text-lg text-gray-600 mb-4">Mở rộng bàn cờ không giới hạn và tùy chỉnh biểu tượng của bạn!</p>

            <!-- Collapsible Section for Player Symbols -->
            <details class="bg-gray-50 rounded-lg p-4 shadow-inner">
                <summary class="flex items-center justify-between cursor-pointer font-bold text-gray-800">
                    Tùy chỉnh biểu tượng
                    <svg class="w-6 h-6 text-gray-600 transform transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </summary>
                <div class="flex flex-col gap-4 mt-4">
                    <div class="flex items-center gap-4">
                        <label for="player-x-symbol" class="text-gray-700 font-semibold">Người chơi X:</label>
                        <input type="text" id="player-x-symbol" class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" value="X">
                    </div>

                    <div class="flex items-center gap-4">
                        <label for="player-o-symbol" class="text-gray-700 font-semibold">Người chơi O:</label>
                        <input type="text" id="player-o-symbol" class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" value="O">
                    </div>
                </div>
            </details>
            
            <div id="status" class="text-2xl font-bold text-gray-800 my-4 text-center p-3 rounded-lg bg-gray-100 shadow-inner">
                Lượt của X
            </div>

            <div class="flex flex-col gap-4">
                <button id="reset-button" class="button w-full py-3 px-6 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-md">
                    Chơi lại
                </button>
                <button id="undo-button" class="button w-full py-3 px-6 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 shadow-md">
                    Hoàn tác
                </button>
                <button id="theme-button" class="button w-full py-3 px-6 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 shadow-md">
                    Đổi giao diện
                </button>
            </div>
        </div>

        <!-- Game Board -->
        <div class="game-board-wrapper">
            <div id="game-board" class="game-board" style="--cols: 15;"></div>
        </div>
    </div>

    <!-- Win/Draw Modal -->
    <div id="modal" class="modal fixed inset-0 flex items-center justify-center opacity-0 pointer-events-none z-50">
        <div class="bg-white p-8 rounded-2xl shadow-xl transform scale-95 transition-transform duration-300">
            <h2 id="modal-message" class="text-3xl font-bold text-center mb-4 text-gray-800"></h2>
            <p class="text-center text-gray-600 mb-6">Xin chúc mừng! Hãy thử lại!</p>
            <button id="modal-close-button" class="w-full py-3 px-6 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-md">
                Đóng
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const board = document.getElementById('game-board');
            const statusDisplay = document.getElementById('status');
            const resetButton = document.getElementById('reset-button');
            const playerXSymbolInput = document.getElementById('player-x-symbol');
            const playerOSymbolInput = document.getElementById('player-o-symbol');
            const modal = document.getElementById('modal');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseButton = document.getElementById('modal-close-button');
            const undoButton = document.getElementById('undo-button');
            const themeButton = document.getElementById('theme-button');

            let boardState = {};
            let currentPlayer = 'X';
            let isGameActive = true;
            let playerSymbols = { 'X': 'X', 'O': 'O' };
            const WIN_CONDITION = 5;

            // Kích thước ban đầu của bàn cờ
            const initialSize = 15;
            let minRow = 0, maxRow = initialSize - 1;
            let minCol = 0, maxCol = initialSize - 1;

            // Hàm tạo bàn cờ ban đầu
            function createBoard(size) {
                board.innerHTML = '';
                board.style.setProperty('--cols', size);
                for (let i = 0; i < size; i++) {
                    for (let j = 0; j < size; j++) {
                        const cell = document.createElement('div');
                        cell.classList.add('cell');
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        board.appendChild(cell);
                    }
                }
            }

            // Hàm kiểm tra thắng cuộc
            function checkWin(row, col) {
                const directions = [
                    [0, 1],   // Hàng ngang
                    [1, 0],   // Hàng dọc
                    [1, 1],   // Đường chéo chính
                    [1, -1]   // Đường chéo phụ
                ];

                for (const [dr, dc] of directions) {
                    let count = 1;
                    let winningCells = [[row, col]];

                    // Kiểm tra về phía trước
                    for (let i = 1; i < WIN_CONDITION; i++) {
                        const newRow = row + i * dr;
                        const newCol = col + i * dc;
                        if (boardState[`${newRow},${newCol}`] === currentPlayer) {
                            count++;
                            winningCells.push([newRow, newCol]);
                        } else {
                            break;
                        }
                    }

                    // Kiểm tra về phía sau
                    for (let i = 1; i < WIN_CONDITION; i++) {
                        const newRow = row - i * dr;
                        const newCol = col - i * dc;
                        if (boardState[`${newRow},${newCol}`] === currentPlayer) {
                            count++;
                            winningCells.push([newRow, newCol]);
                        } else {
                            break;
                        }
                    }

                    if (count >= WIN_CONDITION) {
                        return winningCells;
                    }
                }
                return null;
            }

            // Mở rộng bàn cờ khi cần
            function expandBoard(row, col) {
                let expanded = false;
                if (row === minRow) {
                    minRow--;
                    for (let c = minCol; c <= maxCol; c++) {
                        addCell(minRow, c);
                    }
                    expanded = true;
                }
                if (row === maxRow) {
                    maxRow++;
                    for (let c = minCol; c <= maxCol; c++) {
                        addCell(maxRow, c);
                    }
                    expanded = true;
                }
                if (col === minCol) {
                    minCol--;
                    for (let r = minRow; r <= maxRow; r++) {
                        addCell(r, minCol);
                    }
                    expanded = true;
                }
                if (col === maxCol) {
                    maxCol++;
                    for (let r = minRow; r <= maxRow; r++) {
                        addCell(r, maxCol);
                    }
                    expanded = true;
                }

                if (expanded) {
                    updateGridStyles();
                }
            }
            
            // Cập nhật lại grid styles sau khi mở rộng
            function updateGridStyles() {
                const cols = maxCol - minCol + 1;
                board.style.setProperty('--cols', cols);
                board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                const cells = board.querySelectorAll('.cell');
                cells.forEach(cell => {
                    const r = parseInt(cell.dataset.row);
                    const c = parseInt(cell.dataset.col);
                    cell.style.order = (r - minRow) * cols + (c - minCol);
                });
            }

            // Thêm một ô mới
            function addCell(r, c) {
                if (boardState[`${r},${c}`] !== undefined) return;
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.row = r;
                cell.dataset.col = c;
                board.appendChild(cell);
                boardState[`${r},${c}`] = null;
            }

            // Xử lý click vào ô
            function handleCellClick(event) {
                const cell = event.target;
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);

                if (!isGameActive || boardState[`${row},${col}`]) {
                    return;
                }

                boardState[`${row},${col}`] = currentPlayer;
                cell.textContent = playerSymbols[currentPlayer];
                cell.classList.add(currentPlayer.toLowerCase());

                const winLine = checkWin(row, col);
                if (winLine) {
                    isGameActive = false;
                    winLine.forEach(([r, c]) => {
                        document.querySelector(`[data-row='${r}'][data-col='${c}']`).classList.add('win');
                    });
                    showModal(`Người chơi ${currentPlayer} đã thắng!`);
                } else {
                    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                    statusDisplay.textContent = `Lượt của ${currentPlayer}`;
                }

                expandBoard(row, col);
            }

            // Hiển thị modal
            function showModal(message) {
                modalMessage.textContent = message;
                modal.classList.remove('opacity-0', 'pointer-events-none');
                modal.querySelector('div').classList.remove('scale-95');
                modal.querySelector('div').classList.add('scale-100');
            }

            // Ẩn modal
            function hideModal() {
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.querySelector('div').classList.remove('scale-100');
                modal.querySelector('div').classList.add('scale-95');
            }

            // Thiết lập lại trò chơi
            function resetGame() {
                boardState = {};
                currentPlayer = 'X';
                isGameActive = true;
                statusDisplay.textContent = `Lượt của ${currentPlayer}`;
                minRow = 0; maxRow = initialSize - 1;
                minCol = 0; maxCol = initialSize - 1;
                createBoard(initialSize);
                hideModal();
            }
            
            // Xử lý thay đổi biểu tượng người chơi
            function handleSymbolChange() {
                playerSymbols['X'] = playerXSymbolInput.value.trim() || 'X';
                playerSymbols['O'] = playerOSymbolInput.value.trim() || 'O';
            }

            // Gán sự kiện
            board.addEventListener('click', handleCellClick);
            resetButton.addEventListener('click', resetGame);
            modalCloseButton.addEventListener('click', hideModal);
            playerXSymbolInput.addEventListener('input', handleSymbolChange);
            playerOSymbolInput.addEventListener('input', handleSymbolChange);

            // Placeholder for undo functionality
            undoButton.addEventListener('click', () => {
                alert('Chức năng hoàn tác đang được phát triển!');
            });

            // Placeholder for theme change functionality
            themeButton.addEventListener('click', () => {
                alert('Chức năng đổi giao diện đang được phát triển!');
            });

            // Khởi tạo trò chơi lần đầu
            resetGame();
        });
    </script>
</body>
</html>
