<!DOCTYPE html>
<html lang="en" class="antialiased scroll-smooth" itemscope itemtype="https://schema.org/WebApplication">
<head>
    <meta charset="UTF-8" />
    <!-- Viewport optimized for mobile: no zoom, cover notch area -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#f8fafc" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    
    <!-- SEO & Metadata -->
    <title>Text2 QR Code Generator</title>
    <meta name="description" content="Text2 - QR Code Generator: Create free, professional QR codes with custom logos, colors, and styles. High-quality export for businesses and individuals. Supports URL, Wi-Fi, and business cards.">
    <meta name="keywords" content="Text2 QR Code Generator, QR code generator, free QR code, custom QR code, QR code with logo, professional QR code, online QR code maker, Text2 QR, QR code creator">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="author" content="Text2">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://text02.com/qr">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://text02.com/qr">
    <meta property="og:title" content="Text2 - QR Code Generator | Free Professional QR Code Maker">
    <meta property="og:description" content="Create free, professional QR codes with custom logos and colors. Supports URL, Wi-Fi, and business cards. Export high-quality PNG files.">
    <meta property="og:image" content="https://text02.com/media/thumnel.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Text2 - QR Code Generator">
    <meta property="og:site_name" content="Text2">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://text02.com/qr">
    <meta name="twitter:title" content="Text2 - QR Code Generator | Free Professional QR Code Maker">
    <meta name="twitter:description" content="Create free, professional QR codes with custom logos and colors. Supports URL, Wi-Fi, and business cards.">
    <meta name="twitter:image" content="https://text02.com/media/thumnel.png">
    <meta name="twitter:image:alt" content="Text2 - QR Code Generator">
    <meta name="twitter:site" content="@Text2click">
    
    <!-- Manifest -->
    <link rel="manifest" href="site.webmanifest">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Text2 - QR Code Generator",
      "alternateName": "Text2 QR",
      "url": "https://text02.com/qr",
      "description": "Create free, professional QR codes with custom logos and colors. Supports URL, Wi-Fi, and business cards. Export high-quality PNG files.",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "1250"
      },
      "featureList": [
        "Free QR code generation",
        "Add logo to QR code",
        "Custom colors",
        "Multiple styles (Square, Rounded, Dots)",
        "Supports URL, Wi-Fi, Business Cards",
        "Export high-quality PNG files",
        "Unlimited generation"
      ],
      "screenshot": "https://text02.com/media/thumnel.png",
      "softwareVersion": "1.0",
      "datePublished": "2024-01-01",
      "dateModified": "2024-01-01",
      "author": {
        "@type": "Organization",
        "name": "Text2",
        "url": "https://text02.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Text2",
        "url": "https://text02.com",
        "logo": {
          "@type": "ImageObject",
          "url": "https://text02.com/media/thumnel.png"
        }
      },
      "mainEntity": {
        "@type": "SoftwareApplication",
        "name": "Text2 - QR Code Generator",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        }
      },
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://text02.com"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "QR Code Generator",
            "item": "https://text02.com/qr"
          }
        ]
      }
    }
    </script>
    
    <!-- Additional Schema for Tool -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowToTool",
      "name": "Text2 - QR Code Generator",
      "description": "Free and professional QR code generation tool",
      "url": "https://text02.com/qr",
      "toolCategory": "QR Code Generator",
      "applicationCategory": "Utility"
    }
    </script>
    
    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1722731267767270"
    crossorigin="anonymous"></script>

  <!-- Google tag (gtag.js) - GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ABCDEFG123"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-6J85STMJ14');
  </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: {
                        primary: { 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7' },
                        dark: { bg: '#121212', card: '#1e1e1e', border: 'rgba(255,255,255,0.08)', text: '#c0c0c0' } 
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'pop': 'pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'fade-in': 'fadeIn 0.2s ease-out forwards',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        pop: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>

    <style>
        html, body { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        .dark .glass-panel {
            background: linear-gradient(135deg, #1E1E1E, #242424);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }
        
        .pb-safe { padding-bottom: calc(env(safe-area-inset-bottom) + 16px); }
        .pt-safe { padding-top: calc(env(safe-area-inset-top) + 8px); }
        .qr-enter { animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .btn-active:active { transform: scale(0.96); transition: transform 0.1s; }
        
        /* Tab Transitions */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

        /* Hover Effects */
        .hover-blue:hover {
            background-color: rgba(79,195,247,0.2);
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-dark-bg text-slate-800 dark:text-slate-100 min-h-[100dvh] flex flex-col transition-colors duration-500 overflow-x-hidden selection:bg-primary-500/30">

    <!-- Ambient Background -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-15%] left-[-15%] w-[60vh] h-[60vh] bg-blue-400/20 dark:bg-primary-500/15 rounded-full blur-[80px] animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-20%] w-[50vh] h-[50vh] bg-purple-400/20 dark:bg-purple-500/15 rounded-full blur-[80px] animate-pulse-slow" style="animation-delay: 2s;"></div>
    </div>

    <!-- Header -->
    <header class="flex-none pt-safe px-5 py-3 flex justify-between items-center z-50 transition-all duration-300">
        <div class="flex items-center gap-3 active:opacity-70 transition-opacity cursor-pointer" onclick="window.location.href='https://text02.com'">
            <div class="w-10 h-10 bg-white dark:bg-dark-card rounded-xl flex items-center justify-center shadow-lg shadow-primary-500/10" aria-label="Text2 Logo">
                <img src="https://text02.com/favicon.ico" class="w-9 h-9" alt="Text2 Logo">
            </div>
            <div>
                <h1 class="font-bold text-xl tracking-tight leading-none text-slate-800 dark:text-white">Text2<span class="text-primary-500">QR</span></h1>
                <p class="text-[10px] font-semibold text-slate-400 uppercase tracking-widest">Ultimate</p>
            </div>
        </div>
        <button id="theme-btn" class="w-10 h-10 rounded-full bg-white/80 dark:bg-dark-card/80 backdrop-blur-md border border-slate-200 dark:border-dark-border flex items-center justify-center text-slate-500 hover:text-primary-500 transition-all shadow-sm btn-active">
            <i data-lucide="moon" class="w-5 h-5 dark:hidden fill-current opacity-80"></i>
            <i data-lucide="sun" class="w-5 h-5 hidden dark:block fill-current opacity-80"></i>
        </button>
    </header>

    <!-- Main Content -->
    <main class="flex-1 w-full max-w-lg mx-auto px-5 pb-40 flex flex-col gap-6 pt-2">
        
        <!-- Tab Navigation (Type Selector) -->
        <div class="flex p-1 bg-slate-200/50 dark:bg-dark-card/50 rounded-xl backdrop-blur-sm border border-slate-200 dark:border-dark-border">
            <button onclick="setTab('text')" class="tab-btn flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 dark:text-dark-text transition-all active-tab" data-tab="text">
                Link / Text
            </button>
            <button onclick="setTab('wifi')" class="tab-btn flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 dark:text-dark-text transition-all" data-tab="wifi">
                Wi-Fi
            </button>
            <button onclick="setTab('vcard')" class="tab-btn flex-1 py-2 rounded-lg text-xs font-bold text-slate-500 dark:text-dark-text transition-all" data-tab="vcard">
                Contact
            </button>
        </div>

        <!-- QR Preview Card -->
        <section class="relative group mx-auto w-full max-w-[340px]">
            <div class="absolute -inset-4 bg-gradient-to-tr from-primary-400/30 to-purple-500/30 rounded-[3rem] blur-xl opacity-60 dark:opacity-40 transition duration-1000"></div>
            <div class="relative w-full aspect-square bg-white dark:bg-dark-card rounded-[2rem] shadow-[0_20px_50px_-12px_rgba(0,0,0,0.1)] dark:shadow-none border border-slate-100 dark:border-dark-border flex items-center justify-center p-6 overflow-hidden transition-all duration-500">
                
                <div id="empty-state" class="text-center space-y-4">
                    <div class="w-20 h-20 bg-slate-50 dark:bg-slate-800/50 rounded-2xl mx-auto flex items-center justify-center animate-float border border-slate-100 dark:border-slate-700/50">
                        <i data-lucide="scan-line" class="w-8 h-8 text-primary-400"></i>
                    </div>
                    <div class="space-y-1">
                        <p class="text-base font-bold text-slate-700 dark:text-white">Start Creating</p>
                        <p class="text-xs text-slate-400 font-medium px-4 dark:text-dark-text">Fill the form below to generate</p>
                    </div>
                </div>

                <div id="canvas-wrapper" class="hidden w-full h-full flex items-center justify-center drop-shadow-2xl"></div>
            </div>
        </section>

        <!-- Dynamic Input Forms -->
        <section class="glass-panel rounded-2xl p-4 shadow-lg shadow-slate-200/50 dark:shadow-none animate-slide-up" style="animation-delay: 0.1s;">
            
            <!-- 1. Text/URL Input -->
            <div id="form-text" class="tab-content active space-y-3">
                <div class="relative group">
                    <textarea id="text-input" rows="2" class="w-full bg-transparent text-lg font-medium p-3 rounded-xl text-slate-800 dark:text-white placeholder-slate-400 dark:placeholder-slate-500 resize-none focus:bg-white/50 dark:focus:bg-slate-800/50 border-2 border-transparent focus:border-primary-200 dark:focus:border-primary-900/50 outline-none transition-all" placeholder="https://example.com"></textarea>
                    <button onclick="pasteText()" class="absolute top-2 right-2 p-2 rounded-lg bg-slate-100 dark:bg-slate-700/50 text-slate-500 hover:text-primary-500 transition-colors btn-active">
                        <i data-lucide="clipboard" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- 2. Wi-Fi Input -->
            <div id="form-wifi" class="tab-content space-y-3">
                <input type="text" id="wifi-ssid" placeholder="Network Name (SSID)" class="w-full bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl border border-transparent focus:border-primary-400 outline-none text-slate-800 dark:text-white text-sm font-medium">
                <div class="flex gap-2">
                    <input type="text" id="wifi-pass" placeholder="Password" class="flex-1 bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl border border-transparent focus:border-primary-400 outline-none text-slate-800 dark:text-white text-sm font-medium">
                    <select id="wifi-type" class="bg-slate-100 dark:bg-slate-800 p-3 rounded-xl text-xs font-bold text-slate-600 dark:text-slate-300 outline-none">
                        <option value="WPA">WPA</option>
                        <option value="WEP">WEP</option>
                        <option value="nopass">None</option>
                    </select>
                </div>
            </div>

            <!-- 3. VCard Input -->
            <div id="form-vcard" class="tab-content space-y-3">
                <div class="flex gap-2">
                    <input type="text" id="vcard-fn" placeholder="First Name" class="flex-1 bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl border border-transparent focus:border-primary-400 outline-none text-slate-800 dark:text-white text-sm font-medium">
                    <input type="text" id="vcard-ln" placeholder="Last Name" class="flex-1 bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl border border-transparent focus:border-primary-400 outline-none text-slate-800 dark:text-white text-sm font-medium">
                </div>
                <input type="tel" id="vcard-phone" placeholder="Phone Number" class="w-full bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl border border-transparent focus:border-primary-400 outline-none text-slate-800 dark:text-white text-sm font-medium">
                <input type="email" id="vcard-email" placeholder="Email Address" class="w-full bg-slate-50 dark:bg-slate-800/50 p-3 rounded-xl border border-transparent focus:border-primary-400 outline-none text-slate-800 dark:text-white text-sm font-medium">
            </div>

        </section>

        <!-- Styling & Logo Controls -->
        <section class="space-y-4 animate-slide-up" style="animation-delay: 0.2s;">
            
            <!-- Quick Presets -->
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1 snap-x -mx-5 px-5">
                <button onclick="applyPreset('classic')" class="snap-start flex-none px-4 py-2 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-xs font-bold text-slate-600 dark:text-dark-text btn-active">Classic</button>
                <button onclick="applyPreset('blue')" class="snap-start flex-none px-4 py-2 rounded-full bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 text-xs font-bold text-blue-600 dark:text-blue-400 btn-active">Social</button>
                <button onclick="applyPreset('neon')" class="snap-start flex-none px-4 py-2 rounded-full bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800 text-xs font-bold text-purple-600 dark:text-purple-400 btn-active">Vibe</button>
                <button onclick="applyPreset('love')" class="snap-start flex-none px-4 py-2 rounded-full bg-rose-50 dark:bg-rose-900/20 border border-rose-100 dark:border-rose-800 text-xs font-bold text-rose-600 dark:text-rose-400 btn-active">Love</button>
                <button onclick="applyPreset('dark')" class="snap-start flex-none px-4 py-2 rounded-full bg-slate-800 border border-slate-600 text-xs font-bold text-white btn-active">Dark</button>
            </div>

            <!-- Style & Logo Card -->
            <div class="bg-white/60 dark:bg-dark-card/60 backdrop-blur-md rounded-2xl p-5 border border-slate-200/60 dark:border-dark-border space-y-5">
                
                <!-- Dot Style Selector -->
                <div class="flex items-center justify-between">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-wider dark:text-dark-text">Dot Style</span>
                    <div class="flex gap-2">
                        <button onclick="setDotStyle('square')" class="dot-btn p-2 rounded-lg border border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all active-dot" data-style="square" title="Square">
                            <div class="w-4 h-4 bg-current rounded-sm"></div>
                        </button>
                        <button onclick="setDotStyle('rounded')" class="dot-btn p-2 rounded-lg border border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all" data-style="rounded" title="Rounded">
                            <div class="w-4 h-4 bg-current rounded-md"></div>
                        </button>
                        <button onclick="setDotStyle('dots')" class="dot-btn p-2 rounded-lg border border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all" data-style="dots" title="Dots">
                            <div class="w-4 h-4 bg-current rounded-full"></div>
                        </button>
                    </div>
                </div>

                <div class="h-px bg-slate-100 dark:bg-slate-700/50"></div>

                <!-- Colors -->
                <div class="flex items-center justify-between">
                    <span class="text-sm font-semibold text-slate-600 dark:text-dark-text flex items-center gap-2">
                        <i data-lucide="palette" class="w-4 h-4"></i> Colors
                    </span>
                    <div class="flex gap-4">
                        <div class="flex flex-col items-center gap-1">
                            <div id="picker-fg" class="w-8 h-8 rounded-full border-2 border-white dark:border-slate-600 shadow-sm cursor-pointer"></div>
                            <span class="text-[9px] font-bold text-slate-400 dark:text-dark-text">QR</span>
                        </div>
                        <div class="flex flex-col items-center gap-1">
                            <div id="picker-bg" class="w-8 h-8 rounded-full border-2 border-white dark:border-slate-600 shadow-sm cursor-pointer"></div>
                            <span class="text-[9px] font-bold text-slate-400 dark:text-dark-text">Back</span>
                        </div>
                    </div>
                </div>

                <div class="h-px bg-slate-100 dark:bg-slate-700/50"></div>

                <!-- Logo -->
                <div class="flex justify-between items-center">
                    <span class="text-sm font-semibold text-slate-600 dark:text-dark-text flex items-center gap-2">
                        <i data-lucide="image" class="w-4 h-4"></i> Logo
                    </span>
                    <div class="flex gap-2">
                        <label for="logo-upload" class="cursor-pointer px-4 py-1.5 bg-slate-100 dark:bg-slate-700/50 text-xs font-bold text-primary-600 dark:text-primary-400 rounded-lg btn-active border border-slate-200 dark:border-slate-600">
                            Upload
                        </label>
                        <input type="file" id="logo-upload" accept="image/*" class="hidden">
                        <button id="remove-logo" class="px-3 py-1.5 text-xs font-bold text-rose-500 bg-rose-50 dark:bg-rose-900/10 rounded-lg hidden btn-active">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Bottom Action Bar -->
    <div class="fixed bottom-0 left-0 right-0 z-40 pb-safe pt-4 px-5">
        <div class="absolute inset-0 bg-white/80 dark:bg-dark-bg/90 backdrop-blur-xl border-t border-white/50 dark:border-white/5 shadow-[0_-10px_40px_-10px_rgba(0,0,0,0.05)] rounded-t-[2rem]"></div>
        <div class="max-w-lg mx-auto w-full relative z-10">
            <button id="download-btn" disabled class="w-full h-14 bg-gradient-to-r from-primary-500 to-blue-600 text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary-500/25 transition-all disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed btn-active flex items-center justify-center gap-3 group">
                <span class="group-hover:scale-105 transition-transform">Download PNG</span>
                <i data-lucide="download" class="w-5 h-5 group-hover:translate-y-1 transition-transform"></i>
            </button>
        </div>
    </div>

    <!-- Logic -->
    <script>
        lucide.createIcons();

        // Elements
        const els = {
            inputs: document.querySelectorAll('input, textarea, select'),
            canvasWrapper: document.getElementById('canvas-wrapper'),
            emptyState: document.getElementById('empty-state'),
            downloadBtn: document.getElementById('download-btn'),
            themeBtn: document.getElementById('theme-btn'),
            logoInput: document.getElementById('logo-upload'),
            removeLogoBtn: document.getElementById('remove-logo'),
        };

        // State
        let state = {
            mode: 'text', // text, wifi, vcard
            text: '',
            fgColor: '#1e293b',
            bgColor: '#ffffff',
            logoImg: null,
            dotStyle: 'square', // square, rounded, dots
            isDark: localStorage.getItem('theme') === 'dark'
        };

        const vibrate = () => navigator.vibrate?.(10);

        // --- 1. Tab Switching ---
        window.setTab = (mode) => {
            vibrate();
            state.mode = mode;
            
            // Update Buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if(btn.dataset.tab === mode) {
                    btn.classList.add('bg-white', 'dark:bg-slate-700', 'text-primary-600', 'dark:text-primary-400', 'shadow-sm');
                    btn.classList.remove('text-slate-500', 'dark:text-slate-400');
                } else {
                    btn.classList.remove('bg-white', 'dark:bg-slate-700', 'text-primary-600', 'dark:text-primary-400', 'shadow-sm');
                    btn.classList.add('text-slate-500', 'dark:text-slate-400');
                }
            });

            // Show Content
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`form-${mode}`).classList.add('active');
            
            generate();
        };

        // Init Tab Style
        window.setTab('text');

        // --- 2. Dot Styles ---
        window.setDotStyle = (style) => {
            vibrate();
            state.dotStyle = style;
            document.querySelectorAll('.dot-btn').forEach(btn => {
                const isActive = btn.dataset.style === style;
                btn.classList.toggle('border-primary-500', isActive);
                btn.classList.toggle('text-primary-500', isActive);
                btn.classList.toggle('bg-primary-50', isActive);
                btn.classList.toggle('dark:bg-primary-900/20', isActive);
                if(!isActive) {
                    btn.classList.add('text-slate-400');
                    btn.classList.remove('bg-primary-50', 'dark:bg-primary-900/20');
                }
            });
            generate();
        };
        window.setDotStyle('square'); // Default

        // --- 3. Theme & Colors ---
        function toggleTheme() {
            vibrate();
            state.isDark = !state.isDark;
            document.documentElement.classList.toggle('dark', state.isDark);
            localStorage.setItem('theme', state.isDark ? 'dark' : 'light');
            if(!els.canvasWrapper.querySelector('canvas')) {
                state.fgColor = state.isDark ? '#ffffff' : '#1e293b';
                state.bgColor = state.isDark ? '#121212' : '#ffffff';
                pickrFG.setColor(state.fgColor);
                pickrBG.setColor(state.bgColor);
            }
            generate();
        }
        if(state.isDark) document.documentElement.classList.add('dark');
        els.themeBtn.addEventListener('click', toggleTheme);

        const pickrConfig = { theme: 'nano', components: { preview: true, opacity: false, hue: true, interaction: { input: true, save: true } } };
        const pickrFG = Pickr.create({ ...pickrConfig, el: '#picker-fg', default: state.fgColor }).on('change', c => { state.fgColor = c.toHEXA().toString(); generate(); });
        const pickrBG = Pickr.create({ ...pickrConfig, el: '#picker-bg', default: state.bgColor }).on('change', c => { state.bgColor = c.toHEXA().toString(); generate(); });

        window.applyPreset = (name) => {
            vibrate();
            const presets = {
                classic: { fg: '#000000', bg: '#ffffff' },
                blue: { fg: '#2563eb', bg: '#eff6ff' },
                neon: { fg: '#d946ef', bg: '#2e1065' },
                love: { fg: '#e11d48', bg: '#fff1f2' },
                dark: { fg: '#ffffff', bg: '#121212' }
            };
            const p = presets[name];
            state.fgColor = p.fg; state.bgColor = p.bg;
            pickrFG.setColor(p.fg); pickrBG.setColor(p.bg);
            generate();
        };

        // --- 4. Content Logic ---
        function getQRContent() {
            if (state.mode === 'text') return document.getElementById('text-input').value.trim();
            
            if (state.mode === 'wifi') {
                const ssid = document.getElementById('wifi-ssid').value.trim();
                const pass = document.getElementById('wifi-pass').value;
                const type = document.getElementById('wifi-type').value;
                if (!ssid) return '';
                return `WIFI:S:${ssid};T:${type};P:${pass};;`;
            }

            if (state.mode === 'vcard') {
                const fn = document.getElementById('vcard-fn').value.trim();
                const ln = document.getElementById('vcard-ln').value.trim();
                const phone = document.getElementById('vcard-phone').value.trim();
                const email = document.getElementById('vcard-email').value.trim();
                if (!fn && !ln && !phone) return '';
                return `BEGIN:VCARD\nVERSION:3.0\nN:${ln};${fn}\nFN:${fn} ${ln}\nTEL:${phone}\nEMAIL:${email}\nEND:VCARD`;
            }
            return '';
        }

        window.pasteText = async () => {
            try {
                document.getElementById('text-input').value = await navigator.clipboard.readText();
                generate();
            } catch(e) {}
        };

        let debounce;
        els.inputs.forEach(el => el.addEventListener('input', () => { clearTimeout(debounce); debounce = setTimeout(generate, 150); }));

        // --- 5. Custom QR Drawing (The Pro Part) ---
        function generate() {
            const content = getQRContent();
            
            if (!content) {
                els.canvasWrapper.classList.add('hidden');
                els.emptyState.classList.remove('hidden');
                els.downloadBtn.disabled = true;
                return;
            }

            // Generate Matrix
            const qr = QRCode.create(content, { errorCorrectionLevel: 'H' });
            const modules = qr.modules.data;
            const moduleCount = qr.modules.size;
            const margin = 2; // modules
            const size = 1024;
            const cellSize = size / (moduleCount + margin * 2);

            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');

            // 1. Fill Background
            ctx.fillStyle = state.bgColor;
            ctx.fillRect(0, 0, size, size);

            // 2. Draw Modules
            ctx.fillStyle = state.fgColor;
            
            for (let r = 0; r < moduleCount; r++) {
                for (let c = 0; c < moduleCount; c++) {
                    if (modules[r * moduleCount + c]) {
                        const x = (c + margin) * cellSize;
                        const y = (r + margin) * cellSize;
                        const w = Math.ceil(cellSize);

                        // Position Markers (Always Square-ish for readability)
                        const isPositionMarker = (r < 7 && c < 7) || (r < 7 && c >= moduleCount - 7) || (r >= moduleCount - 7 && c < 7);

                        if (isPositionMarker) {
                            // Rounded corners for markers if style is not square
                            if (state.dotStyle === 'square') ctx.fillRect(x, y, w, w);
                            else {
                                // Just a bit rounded for markers to look clean
                                ctx.beginPath();
                                ctx.roundRect(x, y, w, w, w * 0.1); 
                                ctx.fill();
                            }
                        } else {
                            // Inner Modules
                            ctx.beginPath();
                            if (state.dotStyle === 'dots') {
                                ctx.arc(x + w/2, y + w/2, w/2.4, 0, Math.PI * 2); // 2.4 gives nice spacing
                                ctx.fill();
                            } else if (state.dotStyle === 'rounded') {
                                ctx.roundRect(x + w*0.1, y + w*0.1, w*0.8, w*0.8, w*0.25);
                                ctx.fill();
                            } else {
                                ctx.fillRect(x, y, w, w); // Square
                            }
                        }
                    }
                }
            }

            // 3. Draw Logo
            if (state.logoImg) {
                const logoSize = size * 0.22;
                const logoX = (size - logoSize) / 2;
                const logoY = (size - logoSize) / 2;

                ctx.save();
                ctx.beginPath();
                // Logo Backing
                const pad = 15;
                if(state.dotStyle === 'dots') ctx.arc(size/2, size/2, logoSize/2 + pad, 0, Math.PI*2);
                else ctx.roundRect(logoX - pad, logoY - pad, logoSize + pad*2, logoSize + pad*2, 30);
                
                ctx.fillStyle = state.bgColor;
                ctx.shadowColor = "rgba(0,0,0,0.1)";
                ctx.shadowBlur = 10;
                ctx.fill();
                ctx.shadowColor = "transparent";

                // Clip & Draw
                ctx.beginPath();
                if(state.dotStyle === 'dots') ctx.arc(size/2, size/2, logoSize/2, 0, Math.PI*2);
                else ctx.roundRect(logoX, logoY, logoSize, logoSize, 20);
                ctx.clip();
                
                ctx.drawImage(state.logoImg, logoX, logoY, logoSize, logoSize);
                ctx.restore();
            }

            // Display
            els.canvasWrapper.innerHTML = '';
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            canvas.style.borderRadius = '24px';
            canvas.classList.add('qr-enter');
            els.canvasWrapper.appendChild(canvas);

            els.emptyState.classList.add('hidden');
            els.canvasWrapper.classList.remove('hidden');
            els.downloadBtn.disabled = false;
        }

        // --- 6. Utilities ---
        els.logoInput.addEventListener('change', (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (evt) => {
                const img = new Image();
                img.onload = () => {
                    state.logoImg = img;
                    els.removeLogoBtn.classList.remove('hidden');
                    generate();
                };
                img.src = evt.target.result;
            };
            reader.readAsDataURL(file);
        });

        els.removeLogoBtn.addEventListener('click', () => {
            state.logoImg = null;
            els.logoInput.value = '';
            els.removeLogoBtn.classList.add('hidden');
            generate();
        });

        els.downloadBtn.addEventListener('click', () => {
            vibrate();
            const canvas = els.canvasWrapper.querySelector('canvas');
            if(!canvas) return;
            const link = document.createElement('a');
            link.download = `text2-qr-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            const btn = els.downloadBtn;
            const oldHTML = btn.innerHTML;
            btn.innerHTML = `<span class="flex items-center gap-2">Saved! <i data-lucide="check" class="w-5 h-5"></i></span>`;
            btn.classList.add('brightness-110');
            setTimeout(() => {
                btn.innerHTML = oldHTML;
                btn.classList.remove('brightness-110');
                lucide.createIcons();
            }, 2000);
        });

        // Initialize (if browser auto-filled)
        if(document.getElementById('text-input').value) generate();

    </script>
</body>
</html>