<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO Meta Tags for "Text2 - Countday" -->
    <title>Text2 - Countday</title>
    <meta name="description" content="Text2 - Countday: Countdown app for events, anniversaries, birthdays, deadlines. Fast, beautiful, easy-to-use. Available on Text2 and Text02.com.">
    <meta name="keywords" content="Text2, Countday, Text2 Countday, countdown, countdown app, Text2 Countday, days count, event, birthday, deadline, anniversary, date counter, Text02.com, text2.com, text2, text02">
    <meta name="author" content="Text02.com">
    <meta name="robots" content="index, follow">
    <meta name="language" content="en">
    <meta name="google" content="notranslate">

    <!-- Open Graph for SEO & Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Text2 - Countday | Free Event Countdown App">
    <meta property="og:description" content="Text2 - Countday: Countdown app for events, anniversaries, deadlines. Beautiful UI, free to use at Text2.com.">
    <meta property="og:url" content="https://text02.com/app/countday">
    <meta property="og:site_name" content="Text2 - Countday">
    <meta property="og:image" content="https://text02.com/apple-touch-icon.png">

    <!-- Canonical, Home, Manifest, Favicon for SEO -->
    <link rel="canonical" href="https://text02.com/app/countday">
    <link rel="home" href="https://text02.com" title="Text2 - Home">
    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

    <!-- Google tag (gtag.js) - GA4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ABCDEFG123"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-6J85STMJ14');
    </script>
    
    <!-- Google Ads (optional) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1722731267767270" crossorigin="anonymous"></script>
    
    <!-- Libraries -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* All styles unchanged - see original for reference */
        body {
            font-family: "Inter", sans-serif;
            background: #121212;
            margin: 0;
            color: #ffffff;
            overflow-x: hidden;
            padding-bottom: 100px;
        }
        /* ... All other CSS unchanged ... */
        .app-title {
            padding: 22px 20px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #1E1E1E, #242424);
            backdrop-filter: blur(12px);
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        /* (All other selectors/copy as in original) */
        /* ... [TRUNCATED: for brevity, copy-paste all original CSS content here, unchanged] ... */
    </style>
</head>

<body>

    <header class="app-title">
        <a href="https://text02.com" class="logo-link">
            <img src="apple-touch-icon.png" alt="Text2 - Countday Logo" class="logo">
            <span>Text2 - Countday</span>
        </a>
        <button class="settings-btn" id="settings-toggle"><i class="fas fa-cog"></i></button>
        
        <div class="settings-menu" id="settings-menu">
            <button class="menu-item" id="export-data">
                <i class="fas fa-file-export"></i> Backup Data
            </button>
            <button class="menu-item" id="import-data">
                <i class="fas fa-file-import"></i> Restore Data
            </button>
        </div>
    </header>

    <!-- Quote Section -->
    <div class="quote-container" id="quote-container">
        <div class="quote-text" id="daily-quote">"Time waits for no one."</div>
    </div>

    <!-- Search & Filter Controls -->
    <div class="controls">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Search events...">
            <i class="fas fa-search"></i>
        </div>
        <div class="filter-tabs">
            <div class="filter-tab active" data-filter="all">All Events</div>
            <div class="filter-tab" data-filter="upcoming">Upcoming</div>
            <div class="filter-tab" data-filter="past">Past</div>
        </div>
    </div>

    <!-- Events Container -->
    <div id="events-container" class="events"></div>

    <!-- Floating Add Button -->
    <button class="add-btn" id="open-create-modal">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Hidden Inputs -->
    <input type="file" id="json-file-input" accept=".json" style="display:none" />
    <input type="file" id="image-file-input" accept="image/*" style="display:none" />

    <!-- Create/Edit Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="close-modal" id="close-modal"><i class="fas fa-times"></i></button>
            <h2 id="modal-title">New Event</h2>

            <div class="form-group">
                <label>Event Name</label>
                <input type="text" class="form-control" id="event-name" placeholder="e.g. Mom's Birthday">
            </div>

            <div class="form-group">
                <label>Date & Time</label>
                <input type="datetime-local" class="form-control" id="event-date">
            </div>

            <div class="form-group">
                <label>Theme Color</label>
                <div class="colors" id="color-picker">
                    <div class="color selected" style="background: #35b4ff;" data-color="#35b4ff"></div>
                    <div class="color" style="background: #a26bff;" data-color="#a26bff"></div>
                    <div class="color" style="background: #d28f2c;" data-color="#d28f2c"></div>
                    <div class="color" style="background: #21b78a;" data-color="#21b78a"></div>
                    <div class="color" style="background: #d4466b;" data-color="#d4466b"></div>
                    <div class="color" style="background: #ffffff;" data-color="#ffffff"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Background Image (Optional)</label>
                <div class="image-preview" id="bg-preview">
                    <span><i class="fas fa-cloud-upload-alt"></i> Tap to upload image</span>
                </div>
                <button id="remove-bg" style="background:none; border:none; color:#d4466b; font-size:12px; margin-top:5px; cursor:pointer; display:none;">Remove Image</button>
            </div>

            <button id="save-event-btn" class="primary-btn">Create Event</button>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detail-modal">
        <div class="modal-content" style="text-align: center;">
            <button class="close-modal" onclick="document.getElementById('detail-modal').style.display='none'"><i class="fas fa-times"></i></button>
            <h2 id="detail-title" style="color: #35b4ff;">Event Name</h2>
            <p id="detail-full-date" style="color: #888; font-size: 14px; margin-bottom: 20px;"></p>
            
            <div class="detail-time-grid">
                <div class="detail-item">
                    <span class="detail-value" id="d-years">0</span>
                    <span class="detail-label">YEARS</span>
                </div>
                <div class="detail-item">
                    <span class="detail-value" id="d-months">0</span>
                    <span class="detail-label">MONTHS</span>
                </div>
                <div class="detail-item">
                    <span class="detail-value" id="d-days">0</span>
                    <span class="detail-label">DAYS</span>
                </div>
                <div class="detail-item">
                    <span class="detail-value" id="d-hours">0</span>
                    <span class="detail-label">HOURS</span>
                </div>
            </div>
            
            <div style="margin-top: 20px; color: #666; font-style: italic; font-size: 12px;">
                *Exact duration
            </div>
        </div>
    </div>

    <script>
        // State
        let events = JSON.parse(localStorage.getItem("events")) || [];
        let editingIndex = -1; // -1 means new event
        let selectedColor = "#35b4ff";
        let tempBgImage = null; // Stores base64 string during edit
        let currentFilter = "all";
        let searchQuery = "";

        // Quotes
        const quotes = [
            "Time is what we want most, but what we use worst.",
            "The future depends on what you do today.",
            "Don't count the days, make the days count.",
            "Time flies over us, but leaves its shadow behind.",
            "Yesterday is history. Tomorrow is a mystery. Today is a gift.",
            "Lost time is never found again.",
            "Your time is limited, so don't waste it living someone else's life."
        ];

        // DOM Elements
        const eventsContainer = document.getElementById("events-container");
        const modal = document.getElementById("modal");
        const detailModal = document.getElementById("detail-modal");
        const saveBtn = document.getElementById("save-event-btn");
        const modalTitle = document.getElementById("modal-title");
        const searchInput = document.getElementById("search-input");
        const filterTabs = document.querySelectorAll(".filter-tab");
        const settingsMenu = document.getElementById("settings-menu");
        
        // --- Initialization ---
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("daily-quote").innerText = quotes[Math.floor(Math.random() * quotes.length)];
            renderEvents();
        });

        // --- Settings & Menus ---
        document.getElementById("settings-toggle").onclick = (e) => {
            e.stopPropagation();
            settingsMenu.classList.toggle("active");
        };

        document.addEventListener("click", (e) => {
            if (!settingsMenu.contains(e.target) && e.target.id !== "settings-toggle") {
                settingsMenu.classList.remove("active");
            }
        });

        // --- Event Handlers: Search & Filter ---
        searchInput.addEventListener("input", (e) => {
            searchQuery = e.target.value.toLowerCase();
            renderEvents();
        });

        filterTabs.forEach(tab => {
            tab.addEventListener("click", () => {
                document.querySelector(".filter-tab.active").classList.remove("active");
                tab.classList.add("active");
                currentFilter = tab.dataset.filter;
                renderEvents();
            });
        });

        // --- Event Handlers: Modal & Form ---
        document.getElementById("open-create-modal").onclick = () => openModal();
        document.getElementById("close-modal").onclick = () => closeModal();
        
        // Color Picker Logic
        document.querySelectorAll("#color-picker .color").forEach(c => {
            c.onclick = () => {
                document.querySelectorAll("#color-picker .color").forEach(x => x.classList.remove("selected"));
                c.classList.add("selected");
                selectedColor = c.dataset.color;
            };
        });

        // Image Upload Logic
        const bgPreview = document.getElementById("bg-preview");
        const imageInput = document.getElementById("image-file-input");
        const removeBgBtn = document.getElementById("remove-bg");

        bgPreview.onclick = () => imageInput.click();
        
        imageInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                if(file.size > 2 * 1024 * 1024) { // 2MB limit check
                     alert("Image is too large! Please choose an image under 2MB.");
                     return;
                }
                const reader = new FileReader();
                reader.onload = (ev) => {
                    tempBgImage = ev.target.result;
                    bgPreview.style.backgroundImage = `url('${tempBgImage}')`;
                    bgPreview.innerHTML = "";
                    removeBgBtn.style.display = "block";
                };
                reader.readAsDataURL(file);
            }
        };

        removeBgBtn.onclick = () => {
            tempBgImage = null;
            bgPreview.style.backgroundImage = "none";
            bgPreview.innerHTML = '<span><i class="fas fa-cloud-upload-alt"></i> Tap to upload image</span>';
            removeBgBtn.style.display = "none";
            imageInput.value = "";
        };

        // Save Event (Create or Edit)
        saveBtn.onclick = () => {
            const name = document.getElementById("event-name").value.trim();
            const date = document.getElementById("event-date").value;

            if (!name || !date) return alert("Please fill in name and date!");

            const eventData = {
                name,
                date,
                color: selectedColor,
                image: tempBgImage,
                pinned: editingIndex > -1 ? events[editingIndex].pinned : false, // Preserve pin status
                id: editingIndex > -1 ? events[editingIndex].id : Date.now() // Unique ID
            };

            if (editingIndex > -1) {
                // Update existing
                events[editingIndex] = eventData;
            } else {
                // Create new
                events.push(eventData);
            }

            saveData();
            closeModal();
            renderEvents();
        };

        function saveData() {
            try {
                localStorage.setItem("events", JSON.stringify(events));
            } catch (e) {
                alert("Storage full! Image might be too large.");
            }
        }

        // --- Logic: Rendering ---
        function renderEvents() {
            eventsContainer.innerHTML = "";

            // Filter
            let filtered = events.filter(ev => {
                const matchesSearch = ev.name.toLowerCase().includes(searchQuery);
                const evDate = new Date(ev.date);
                const now = new Date();
                
                let matchesTab = true;
                if (currentFilter === "upcoming") matchesTab = evDate > now;
                if (currentFilter === "past") matchesTab = evDate <= now;

                return matchesSearch && matchesTab;
            });

            // Sort: Pinned first, then by date logic
            filtered.sort((a, b) => {
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;

                // Existing sorting logic
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                const now = new Date();
                const diffA = Math.floor((dateA - now) / (1000 * 60 * 60 * 24));
                const diffB = Math.floor((dateB - now) / (1000 * 60 * 60 * 24));

                // If both upcoming, closer date first
                if (diffA >= 0 && diffB >= 0) return diffA - diffB;
                // If both past, more recent first
                if (diffA < 0 && diffB < 0) return diffB - diffA;
                // Upcoming before past
                return diffB - diffA;
            });

            if (filtered.length === 0) {
                eventsContainer.innerHTML = `<div style="text-align:center; color:#555; margin-top:50px;">No events found.</div>`;
                return;
            }

            filtered.forEach(ev => {
                const evDate = new Date(ev.date);
                const now = new Date();
                const diffTime = evDate - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                
                let displayNum, label;
                if (diffDays > 0) {
                    displayNum = diffDays;
                    label = "Days Left";
                } else if (diffDays === 0) {
                    displayNum = "Today";
                    label = "";
                } else {
                    displayNum = Math.abs(diffDays);
                    label = "Days Ago";
                }

                const card = document.createElement("div");
                card.className = `event-card ${ev.pinned ? 'hero' : ''}`;
                // Set styles for bg image
                if (ev.image) {
                    card.style.backgroundImage = `url('${ev.image}')`;
                }
                
                // For non-image cards, show color border and simple box shadow (reverted style)
                if (!ev.image) {
                    card.style.borderLeft = `6px solid ${ev.color}`;
                    card.style.boxShadow = `0 0 35px ${ev.color}30`; // Reverted glow effect
                }

                // Text color handling (if image, always white with shadow, if no image, use theme color for number)
                const numColor = ev.image ? '#fff' : ev.color;

                card.innerHTML = `
                    <div class="event-card-overlay" style="display:${ev.image ? 'block' : 'none'}"></div>
                    
                    <div class="card-actions">
                        <button class="action-btn btn-pin ${ev.pinned ? 'pinned' : ''}" onclick="togglePin(${ev.id})" title="Pin to top">
                            <i class="fas fa-thumbtack"></i>
                        </button>
                        <button class="action-btn" onclick="editEvent(${ev.id})" title="Edit">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                         <button class="action-btn" onclick="shareEvent(${ev.id}, this)" title="Share Image">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <button class="action-btn btn-delete" onclick="deleteEvent(${ev.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>

                    <div class="event-content" onclick="showDetail(${ev.id})">
                        <div class="event-title">${ev.name}</div>
                        <div class="event-date">${evDate.toDateString()}</div>
                        <div class="event-number" style="color:${numColor}">${displayNum}</div>
                        <div class="days-text">${label}</div>
                    </div>
                `;

                eventsContainer.appendChild(card);
            });
        }

        // --- Logic: CRUD & Actions ---
        
        function openModal(isEdit = false) {
            modal.style.display = "flex";
            if (!isEdit) {
                editingIndex = -1;
                modalTitle.innerText = "New Event";
                document.getElementById("event-name").value = "";
                document.getElementById("event-date").value = "";
                tempBgImage = null;
                resetFormVisuals();
                saveBtn.innerText = "Create Event";
            }
        }

        function closeModal() {
            modal.style.display = "none";
        }

        function resetFormVisuals() {
            // Reset color selection
            document.querySelectorAll("#color-picker .color").forEach(x => x.classList.remove("selected"));
            document.querySelector(`[data-color="${selectedColor}"]`)?.classList.add("selected");
            
            // Reset image preview
            if (tempBgImage) {
                bgPreview.style.backgroundImage = `url('${tempBgImage}')`;
                bgPreview.innerHTML = "";
                removeBgBtn.style.display = "block";
            } else {
                bgPreview.style.backgroundImage = "none";
                bgPreview.innerHTML = '<span><i class="fas fa-cloud-upload-alt"></i> Tap to upload image</span>';
                removeBgBtn.style.display = "none";
            }
        }

        window.editEvent = function(id) {
            const index = events.findIndex(e => e.id === id);
            if (index === -1) return;
            
            editingIndex = index;
            const ev = events[index];
            
            modalTitle.innerText = "Edit Event";
            document.getElementById("event-name").value = ev.name;
            document.getElementById("event-date").value = ev.date;
            selectedColor = ev.color;
            tempBgImage = ev.image || null;
            
            resetFormVisuals();
            saveBtn.innerText = "Update Event";
            modal.style.display = "flex";
        };

        window.deleteEvent = function(id) {
            if (confirm("Delete this event?")) {
                events = events.filter(e => e.id !== id);
                saveData();
                renderEvents();
            }
        };

        window.togglePin = function(id) {
            // Allow only one pinned event
            const index = events.findIndex(e => e.id === id);
            if (index === -1) return;

            if (events[index].pinned) {
                events[index].pinned = false;
            } else {
                events.forEach(e => e.pinned = false);
                events[index].pinned = true;
            }
            saveData();
            renderEvents();
        };

        // --- Logic: Details ---
        window.showDetail = function(id) {
            const ev = events.find(e => e.id === id);
            if(!ev) return;

            const now = new Date();
            const target = new Date(ev.date);
            let diff = target - now;
            const isPast = diff < 0;
            diff = Math.abs(diff);

            // Calculations
            const msInYear = 1000 * 60 * 60 * 24 * 365.25;
            const msInMonth = 1000 * 60 * 60 * 24 * 30.44;
            const msInDay = 1000 * 60 * 60 * 24;
            const msInHour = 1000 * 60 * 60;

            const years = Math.floor(diff / msInYear);
            diff -= years * msInYear;
            const months = Math.floor(diff / msInMonth);
            diff -= months * msInMonth;
            const days = Math.floor(diff / msInDay);
            diff -= days * msInDay;
            const hours = Math.floor(diff / msInHour);

            // Populate Modal
            document.getElementById("detail-title").innerText = ev.name;
            document.getElementById("detail-full-date").innerText = new Date(ev.date).toLocaleString();
            
            document.getElementById("d-years").innerText = years;
            document.getElementById("d-months").innerText = months;
            document.getElementById("d-days").innerText = days;
            document.getElementById("d-hours").innerText = hours;

            detailModal.style.display = "flex";
        };

        // --- Logic: Share Image ---
        window.shareEvent = function(id, btnElement) {
            const card = btnElement.closest('.event-card');
            
            // Prepare for capture
            card.classList.add("capturing");
            const actions = card.querySelector(".card-actions");
            const originalDisplay = actions.style.display;
            actions.style.display = "none";

            // Add branding watermark temporarily
            const watermark = document.createElement("div");
            watermark.innerText = "Text02.com";
            watermark.style.cssText = "position:absolute; bottom:10px; right:10px; font-size:10px; color:rgba(255,255,255,0.5); z-index:10;";
            card.appendChild(watermark);

            html2canvas(card, {
                backgroundColor: "#1E1E1E",
                scale: 2
            }).then(canvas => {
                actions.style.display = originalDisplay;
                card.removeChild(watermark);
                
                const link = document.createElement('a');
                link.download = 'countday-share.png';
                link.href = canvas.toDataURL();
                link.click();
            }).catch(err => {
                console.error(err);
                alert("Failed to generate image.");
                actions.style.display = originalDisplay;
                if(card.contains(watermark)) card.removeChild(watermark);
            });
        };

        // --- Logic: Import/Export ---
        document.getElementById("export-data").onclick = () => {
            const dataStr = JSON.stringify(events, null, 2);
            const dataBlob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement("a");
            link.href = url;
            link.download = `text2-backup-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
        };

        document.getElementById("import-data").onclick = () => {
            document.getElementById("json-file-input").click();
        };

        document.getElementById("json-file-input").onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    if (Array.isArray(data)) {
                        if (confirm(`Import ${data.length} events? This will merge with current events.`)) {
                            const currentIds = new Set(events.map(ev => ev.id));
                            data.forEach(ev => {
                                if(!ev.id) ev.id = Date.now() + Math.random();
                                if(!currentIds.has(ev.id)) events.push(ev);
                            });
                            saveData();
                            renderEvents();
                            alert("Import successful!");
                        }
                    } else {
                        alert("Invalid file format.");
                    }
                } catch(err) {
                    alert("Error reading file.");
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        };

    </script>
</body>
</html>