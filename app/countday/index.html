<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Moments - Countdown</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap');
      
      body {
        font-family: 'Inter', sans-serif;
        background-color: #000;
      }
      
      /* Hide scrollbar */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }

      /* Animations */
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      .animate-in {
        animation: fadeIn 0.2s ease-out forwards;
      }
    </style>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      // --- ICONS (Inline SVG replacements for lucide-react) ---
      const Plus = ({ size = 24, className = "", strokeWidth = 2 }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
      );

      const X = ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      );

      const Trash2 = ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
      );

      const Calendar = ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
      );

      // --- CONSTANTS ---
      const THEMES = {
        blue: 'from-blue-500 to-cyan-400',
        purple: 'from-violet-500 to-fuchsia-400',
        orange: 'from-orange-500 to-amber-400',
        green: 'from-emerald-500 to-teal-400',
        pink: 'from-rose-500 to-pink-400',
      };

      const THEME_SHADOWS = {
        blue: 'shadow-blue-500/40',
        purple: 'shadow-violet-500/40',
        orange: 'shadow-orange-500/40',
        green: 'shadow-emerald-500/40',
        pink: 'shadow-rose-500/40',
      };

      // --- COMPONENTS ---

      // 1. AddEventModal Component
      const AddEventModal = ({ isOpen, onClose, onAdd }) => {
        const [title, setTitle] = useState('');
        const [date, setDate] = useState('');
        const [theme, setTheme] = useState('blue');

        if (!isOpen) return null;

        const handleSubmit = (e) => {
          e.preventDefault();
          if (!title || !date) return;
          onAdd(title, date, theme);
          setTitle('');
          setDate('');
          setTheme('blue');
          onClose();
        };

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={onClose} />
            <div className="bg-gray-900 border border-white/10 w-full max-w-md rounded-3xl p-6 relative z-10 shadow-2xl animate-in">
              <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-bold text-white">Sự kiện mới</h2>
                  <button onClick={onClose} className="text-gray-400 hover:text-white bg-white/5 hover:bg-white/10 p-2 rounded-full transition-all">
                      <X size={20} />
                  </button>
              </div>

              <form onSubmit={handleSubmit} className="space-y-6">
                <div className="space-y-2">
                  <label className="text-sm text-gray-400 font-medium ml-1">Tên sự kiện</label>
                  <input
                    type="text"
                    value={title}
                    onChange={(e) => setTitle(e.target.value)}
                    placeholder="Ví dụ: Sinh nhật, Kỷ niệm..."
                    className="w-full bg-black/20 border border-white/10 rounded-2xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/50 transition-all"
                    required
                  />
                </div>

                <div className="space-y-2">
                  <label className="text-sm text-gray-400 font-medium ml-1">Ngày diễn ra</label>
                  <input
                    type="date"
                    value={date}
                    onChange={(e) => setDate(e.target.value)}
                    className="w-full bg-black/20 border border-white/10 rounded-2xl px-4 py-3 text-white focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/50 transition-all [color-scheme:dark]"
                    required
                  />
                </div>

                <div className="space-y-2">
                  <label className="text-sm text-gray-400 font-medium ml-1">Chủ đề màu sắc</label>
                  <div className="flex gap-3 justify-between">
                    {Object.keys(THEMES).map((c) => (
                      <button
                        key={c}
                        type="button"
                        onClick={() => setTheme(c)}
                        className={`w-10 h-10 rounded-full bg-gradient-to-br ${THEMES[c]} transition-transform ${
                          theme === c ? 'scale-125 ring-2 ring-white ring-offset-2 ring-offset-gray-900' : 'hover:scale-110 opacity-70 hover:opacity-100'
                        }`}
                      />
                    ))}
                  </div>
                </div>

                <button
                  type="submit"
                  className="w-full bg-white text-black font-bold text-lg py-4 rounded-2xl hover:bg-gray-200 transition-colors mt-4 shadow-lg shadow-white/10"
                >
                  Tạo Sự Kiện
                </button>
              </form>
            </div>
          </div>
        );
      };

      // 2. EventCard Component
      const EventCard = ({ event, onDelete }) => {
        const { diff, label, isPast, isToday } = useMemo(() => {
          const now = new Date();
          const target = new Date(event.date);
          
          // Reset hours to compare dates only
          const nowReset = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          const targetReset = new Date(target.getFullYear(), target.getMonth(), target.getDate());
          
          const diffTime = targetReset.getTime() - nowReset.getTime();
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          if (diffDays === 0) {
              return { diff: 0, label: 'Hôm nay', isPast: false, isToday: true };
          }
          
          const isPast = diffDays < 0;
          
          return { 
              diff: Math.abs(diffDays), 
              label: isPast ? 'Ngày đã qua' : 'Ngày nữa',
              isPast,
              isToday: false
          };
        }, [event.date]);

        const formattedDate = new Date(event.date).toLocaleDateString('vi-VN', {
          weekday: 'short', year: 'numeric', month: 'short', day: 'numeric'
        });

        return (
          <div className={`relative group overflow-hidden rounded-3xl bg-gray-900 border border-white/10 p-6 transition-all duration-300 hover:scale-[1.02] ${THEME_SHADOWS[event.theme]} hover:shadow-xl shadow-lg`}>
            {/* Background Gradient Mesh */}
            <div className={`absolute top-0 right-0 -mr-16 -mt-16 w-48 h-48 rounded-full blur-3xl opacity-20 bg-gradient-to-br ${THEMES[event.theme]}`}></div>
            <div className={`absolute bottom-0 left-0 -ml-16 -mb-16 w-48 h-48 rounded-full blur-3xl opacity-10 bg-gradient-to-tr ${THEMES[event.theme]}`}></div>

            <div className="relative z-10 flex justify-between items-start mb-4">
              <div>
                <h3 className="text-xl font-bold text-white tracking-wide">{event.title}</h3>
                <div className="flex items-center text-gray-400 text-xs mt-1 uppercase tracking-wider font-medium">
                  <Calendar className="w-3 h-3 mr-1" />
                  {formattedDate}
                </div>
              </div>
              <button 
                  onClick={(e) => { e.stopPropagation(); onDelete(event.id); }}
                  className="text-gray-500 hover:text-red-400 transition-colors p-2 -mr-2 -mt-2 opacity-0 group-hover:opacity-100"
              >
                  <Trash2 size={18} />
              </button>
            </div>

            <div className="relative z-10 flex items-baseline mt-2">
              {isToday ? (
                  <span className={`text-4xl font-black bg-clip-text text-transparent bg-gradient-to-r ${THEMES[event.theme]}`}>
                      HAPPENING NOW
                  </span>
              ) : (
                  <>
                      <span className={`text-6xl font-black bg-clip-text text-transparent bg-gradient-to-br ${THEMES[event.theme]}`}>
                      {isPast ? '+' : ''}{diff}
                      </span>
                      <span className="ml-2 text-lg font-medium text-gray-400">{label}</span>
                  </>
              )}
            </div>
          </div>
        );
      };

      // 3. Main App Component
      const App = () => {
        const [events, setEvents] = useState(() => {
          const saved = localStorage.getItem('moments_events');
          return saved ? JSON.parse(saved) : [];
        });
        const [isModalOpen, setIsModalOpen] = useState(false);

        useEffect(() => {
          localStorage.setItem('moments_events', JSON.stringify(events));
        }, [events]);

        const handleAddEvent = (title, date, theme) => {
          const newEvent = {
            id: crypto.randomUUID(),
            title,
            date,
            theme,
          };
          // Sort events by date (closest first)
          setEvents(prev => [...prev, newEvent].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime()));
        };

        const handleDeleteEvent = (id) => {
          if(confirm('Bạn có chắc muốn xóa sự kiện này?')) {
             setEvents(prev => prev.filter(e => e.id !== id));
          }
        };

        return (
          <div className="min-h-screen bg-black text-white font-sans selection:bg-white/20">
            <div className="max-w-md mx-auto min-h-screen flex flex-col relative bg-gray-950 shadow-2xl">
              
              {/* Header */}
              <header className="p-8 pb-4">
                <h1 className="text-4xl font-black tracking-tight mb-1 bg-gradient-to-r from-white to-gray-500 bg-clip-text text-transparent">Moments.</h1>
                <p className="text-gray-400 text-sm font-medium">Theo dõi hành trình của bạn</p>
              </header>

              {/* Content */}
              <main className="flex-1 p-6 space-y-6 pb-32 overflow-y-auto scrollbar-hide">
                {events.length === 0 ? (
                  <div className="flex flex-col items-center justify-center h-[50vh] text-center opacity-50 space-y-4">
                    <div className="w-24 h-24 rounded-full bg-gradient-to-tr from-gray-800 to-gray-900 flex items-center justify-center animate-pulse">
                      <Plus size={40} className="text-gray-700" />
                    </div>
                    <p className="text-gray-500 font-medium">Chưa có sự kiện nào.<br/>Chạm vào dấu + để bắt đầu.</p>
                  </div>
                ) : (
                  events.map(event => (
                    <EventCard 
                      key={event.id} 
                      event={event} 
                      onDelete={handleDeleteEvent}
                    />
                  ))
                )}
              </main>

              {/* Floating Action Button */}
              <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-40">
                  <button
                      onClick={() => setIsModalOpen(true)}
                      className="group relative flex items-center justify-center w-16 h-16 rounded-full bg-white text-black shadow-lg hover:shadow-white/25 transition-all hover:scale-110 active:scale-95"
                  >
                      <span className="absolute inset-0 rounded-full bg-white opacity-20 group-hover:animate-ping"></span>
                      <Plus size={32} strokeWidth={2.5} />
                  </button>
              </div>
              
              {/* Gradient Blur at bottom */}
              <div className="fixed bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black via-black/80 to-transparent pointer-events-none z-30 max-w-md mx-auto" />
            </div>

            <AddEventModal 
              isOpen={isModalOpen} 
              onClose={() => setIsModalOpen(false)} 
              onAdd={handleAddEvent} 
            />
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>