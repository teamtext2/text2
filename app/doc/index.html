<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minimal Doc</title>
  <style>
    :root{
      --bg:#f7f7f8; --panel:#ffffff; --text:#0a0a0a; --muted:#6b7280; --primary:#111827; --ring:#e5e7eb;
      --toolbar:#fafafa; --btn:#f3f4f6; --btn-hover:#e5e7eb;
    }
    :root.dark{
      --bg:#0b0c0f; --panel:#111217; --text:#f5f7fb; --muted:#9aa3b2; --primary:#d8dbe3; --ring:#1f2430;
      --toolbar:#0f1115; --btn:#141821; --btn-hover:#1a2130;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"}

    .app{max-width:1100px;margin:32px auto;padding:0 20px}
    .titlebar{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(145deg,#111827, #374151); box-shadow:0 6px 20px rgba(0,0,0,.18)}
    .name{font-weight:700;letter-spacing:.2px}
    .grow{flex:1}

    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:10px;border:1px solid var(--ring);border-bottom:0;border-top-left-radius:16px;border-top-right-radius:16px;background:var(--toolbar)}
    .btn{appearance:none;border:1px solid var(--ring);background:var(--btn);padding:8px 10px;border-radius:12px;cursor:pointer;transition:all .15s ease;font-weight:600;min-width:36px}
    .btn:hover{background:var(--btn-hover);transform:translateY(-1px)}
    .btn[aria-pressed="true"]{outline:2px solid #9ca3af}
    .divider{width:1px;height:28px;background:var(--ring);margin:0 2px}
    .input{border:1px solid var(--ring);background:var(--panel);color:var(--text);padding:8px 10px;border-radius:12px;min-width:220px}

    .editor-wrap{border:1px solid var(--ring);background:var(--panel);border-bottom-left-radius:16px;border-bottom-right-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.06)}
    .title{width:100%;border:0;outline:0;background:transparent;font-size:28px;font-weight:800;padding:18px 22px;border-bottom:1px solid var(--ring); color:var(--text)}

    .editor{min-height:60vh;padding:24px 22px;font-size:18px;outline:none}
    .editor:empty:before{content:attr(data-placeholder); color:var(--muted)}

    .statusbar{display:flex;gap:12px;align-items:center;justify-content:space-between;color:var(--muted);padding:12px 16px;border-top:1px dashed var(--ring);font-size:13px}

    /* Content styling for a refined reading look */
    .editor h1{font-size:2rem;line-height:1.25;margin:1.1em 0 .6em;font-weight:800}
    .editor h2{font-size:1.5rem;line-height:1.25;margin:1em 0 .5em;font-weight:700}
    .editor p{margin:.7em 0}
    .editor ul,.editor ol{margin:.6em 0 .6em 1.2em}
    .editor blockquote{border-left:3px solid var(--ring);margin:.8em 0;padding:.2em 1em;color:var(--muted)}
    .editor a{color:inherit;text-decoration:underline dotted}

    /* Print clean */
    @media print{
      .toolbar,.statusbar,.titlebar{display:none!important}
      body{background:#fff;color:#000}
      .editor-wrap{border:0;box-shadow:none}
      .editor{min-height:auto}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="titlebar">
      <div class="logo" aria-hidden="true"></div>
      <div class="name">Minimal Doc</div>
      <div class="grow"></div>
      <button id="darkBtn" class="btn" title="Ch·∫ø ƒë·ªô t·ªëi">üåô</button>
    </div>

    <div class="toolbar" role="toolbar" aria-label="Thanh c√¥ng c·ª•">
      <button class="btn" id="newBtn" title="T·∫°o t√†i li·ªáu m·ªõi (Ctrl+N)">M·ªõi</button>
      <input id="fileOpen" type="file" accept=".txt,.md,.html,.htm" hidden />
      <button class="btn" id="openBtn" title="M·ªü file (.txt/.md/.html)">M·ªü</button>
      <button class="btn" id="saveHtmlBtn" title="L∆∞u d·∫°ng HTML (Ctrl+S)">L∆∞u HTML</button>
      <button class="btn" id="saveTxtBtn" title="Xu·∫•t TXT">Xu·∫•t TXT</button>
      <button class="btn" id="printBtn" title="In (Ctrl+P)">In</button>
      <div class="divider"></div>

      <button class="btn" data-cmd="bold" title="ƒê·∫≠m (Ctrl+B)"><b>B</b></button>
      <button class="btn" data-cmd="italic" title="Nghi√™ng (Ctrl+I)"><i>I</i></button>
      <button class="btn" data-cmd="underline" title="G·∫°ch d∆∞·ªõi (Ctrl+U)"><u>U</u></button>
      <button class="btn" id="clearBtn" title="X√≥a ƒë·ªãnh d·∫°ng">Clear</button>
      <div class="divider"></div>

      <button class="btn" data-block="h1" title="Ti√™u ƒë·ªÅ l·ªõn">H1</button>
      <button class="btn" data-block="h2" title="Ti√™u ƒë·ªÅ v·ª´a">H2</button>
      <button class="btn" data-block="p" title="ƒêo·∫°n vƒÉn">P</button>
      <div class="divider"></div>

      <button class="btn" data-cmd="insertUnorderedList" title="Danh s√°ch ch·∫•m">‚Ä¢ List</button>
      <button class="btn" data-cmd="insertOrderedList" title="Danh s√°ch s·ªë">1. List</button>
      <div class="divider"></div>

      <button class="btn" data-cmd="justifyLeft" title="CƒÉn tr√°i">‚ü∏</button>
      <button class="btn" data-cmd="justifyCenter" title="CƒÉn gi·ªØa">‚â°</button>
      <button class="btn" data-cmd="justifyRight" title="CƒÉn ph·∫£i">‚üπ</button>
      <div class="divider"></div>

      <button class="btn" id="undoBtn" title="Ho√†n t√°c (Ctrl+Z)">‚Ü∫</button>
      <button class="btn" id="redoBtn" title="L√†m l·∫°i (Ctrl+Y)">‚Üª</button>
      <div class="divider"></div>

      <input id="linkInput" class="input" type="url" placeholder="D√°n link v√† Enter ƒë·ªÉ ch√®n"/>
    </div>

    <div class="editor-wrap">
      <input id="docTitle" class="title" placeholder="Ti√™u ƒë·ªÅ t√†i li·ªáu" spellcheck="false" />
      <div id="editor" class="editor" contenteditable="true" spellcheck="true" data-placeholder="G√µ n·ªôi dung ·ªü ƒë√¢y‚Ä¶"></div>
      <div class="statusbar">
        <div id="statusLeft">ƒê√£ l∆∞u t·ª± ƒë·ªông</div>
        <div id="statusRight">0 t·ª´ ‚Ä¢ 0 k√Ω t·ª±</div>
      </div>
    </div>
  </div>

  <script>
    const $ = (sel)=>document.querySelector(sel);
    const editor = $('#editor');
    const titleInput = $('#docTitle');
    const statusLeft = $('#statusLeft');
    const statusRight = $('#statusRight');

    // ---- Commands ----
    document.querySelectorAll('[data-cmd]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.execCommand(btn.dataset.cmd,false,null);
        editor.focus();
        saveToLocal();
        updateCount();
      });
    });

    document.querySelectorAll('[data-block]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const tag = btn.dataset.block.toUpperCase();
        document.execCommand('formatBlock', false, tag);
        editor.focus();
        saveToLocal();
      })
    });

    // Clear formatting
    $('#clearBtn').addEventListener('click',()=>{
      document.execCommand('removeFormat');
      editor.querySelectorAll('h1,h2').forEach(n=>{const p=document.createElement('p'); p.innerHTML=n.innerHTML; n.replaceWith(p)});
      saveToLocal();
      editor.focus();
    });

    // Undo/Redo
    $('#undoBtn').addEventListener('click',()=>document.execCommand('undo'));
    $('#redoBtn').addEventListener('click',()=>document.execCommand('redo'));

    // Link insert from input
    const linkInput = $('#linkInput');
    linkInput.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){
        e.preventDefault();
        const url = linkInput.value.trim();
        if(url){ document.execCommand('createLink', false, url); linkInput.value=''; editor.focus(); saveToLocal(); }
      }
    });

    // ---- File Ops ----
    $('#newBtn').addEventListener('click',()=>{
      if(editor.innerText.trim() && !confirm('X√≥a n·ªôi dung hi·ªán t·∫°i v√† t·∫°o t√†i li·ªáu m·ªõi?')) return;
      titleInput.value=''; editor.innerHTML=''; saveToLocal(); updateCount();
    });

    $('#openBtn').addEventListener('click',()=>$('#fileOpen').click());

    $('#fileOpen').addEventListener('change', async (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const text = await file.text();
      const ext = (file.name.split('.').pop()||'').toLowerCase();
      titleInput.value = file.name.replace(/\.(txt|md|html?|)$/i,'');
      if(ext==='html' || ext==='htm'){ editor.innerHTML = text; }
      else { editor.innerText = text; }
      saveToLocal(); updateCount();
      e.target.value='';
    });

    $('#saveHtmlBtn').addEventListener('click',()=>{
      const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>${escapeHtml(titleInput.value||'Untitled')}</title></head><body>${editor.innerHTML}</body></html>`;
      download(`${safeName(titleInput.value||'Untitled')}.html`, html);
    });

    $('#saveTxtBtn').addEventListener('click',()=>{
      const txt = editor.innerText.replace(/\n{3,}/g,'\n\n');
      download(`${safeName(titleInput.value||'Untitled')}.txt`, txt);
    });

    $('#printBtn').addEventListener('click',()=>window.print());

    function download(name, content){
      const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = name; a.click();
      URL.revokeObjectURL(a.href);
    }

    function safeName(s){ return s.trim().replace(/[^\p{L}\p{N}\- _]+/gu,'_').slice(0,60)||'Untitled'; }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

    // ---- Autosave ----
    const key = 'minimal-doc-v1';
    function saveToLocal(){
      const data = {title:titleInput.value, html: editor.innerHTML, updated: Date.now(), dark: document.documentElement.classList.contains('dark')};
      localStorage.setItem(key, JSON.stringify(data));
      statusLeft.textContent = 'ƒê√£ l∆∞u';
      setTimeout(()=> statusLeft.textContent = 'T·ª± ƒë·ªông l∆∞u', 1200);
    }
    function restore(){
      try{
        const data = JSON.parse(localStorage.getItem(key)||'null');
        if(data){
          titleInput.value = data.title || '';
          editor.innerHTML = data.html || '';
          if(data.dark) document.documentElement.classList.add('dark');
        }
      }catch{ /* ignore */ }
      updateCount();
    }
    restore();

    // Save when typing (throttled)
    let t;
    editor.addEventListener('input', ()=>{ clearTimeout(t); t=setTimeout(()=>{saveToLocal(); updateCount();}, 250); });
    titleInput.addEventListener('input', ()=>{ clearTimeout(t); t=setTimeout(saveToLocal, 250); });

    // ---- Word/Char count ----
    function updateCount(){
      const text = editor.innerText.trim();
      const words = text ? text.split(/\s+/).length : 0;
      const chars = text.length;
      statusRight.textContent = `${words} t·ª´ ‚Ä¢ ${chars} k√Ω t·ª±`;
    }

    // ---- Dark mode ----
    $('#darkBtn').addEventListener('click',()=>{
      document.documentElement.classList.toggle('dark');
      saveToLocal();
    });

    // ---- Shortcuts ----
    window.addEventListener('keydown',(e)=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); $('#saveHtmlBtn').click(); }
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='n'){ e.preventDefault(); $('#newBtn').click(); }
      // Let browser handle Ctrl+P, Ctrl+B/I/U, Ctrl+Z/Y
    });

    // Focus editor on load if empty
    window.addEventListener('load', ()=>{ if(!editor.textContent.trim()) editor.focus(); });
  </script>
</body>
</html>